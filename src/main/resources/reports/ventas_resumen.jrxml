<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd"
              name="ventas_resumen" pageWidth="595" pageHeight="842" columnWidth="555" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20">
    <parameter name="P_FECHA_INI" class="java.util.Date"/>
    <parameter name="P_FECHA_FIN" class="java.util.Date"/>
    <parameter name="P_CLIENTE_ID" class="java.lang.Long"/>
    <queryString>
        <![CDATA[
SELECT DATE(f.fecha) AS fecha_dia,
       SUM(d.subtotal) AS total_dia
FROM factura f
JOIN pedido p     ON p.id = f.pedido_id
JOIN pedido_det d ON d.pedido_id = p.id
WHERE f.fecha BETWEEN $P{P_FECHA_INI} AND $P{P_FECHA_FIN}
  AND ( $P{P_CLIENTE_ID} IS NULL OR p.cliente_id = $P{P_CLIENTE_ID} )
GROUP BY DATE(f.fecha)
ORDER BY DATE(f.fecha)
        ]]>
    </queryString>

    <field name="fecha_dia" class="java.sql.Date"/>
    <field name="total_dia" class="java.math.BigDecimal"/>
    <variable name="TOTAL" class="java.math.BigDecimal" calculation="Sum">
        <variableExpression><![CDATA[$F{total_dia}]]></variableExpression>
    </variable>

    <title>
        <band height="40">
            <textField><reportElement x="0" y="0" width="555" height="20"/><textElement textAlignment="Center"/><textFieldExpression><![CDATA["VENTAS — RESUMEN POR DÍA"]]></textFieldExpression></textField>
            <textField><reportElement x="0" y="20" width="555" height="20"/><textElement textAlignment="Center"/><textFieldExpression><![CDATA["Del: " + new java.text.SimpleDateFormat("yyyy-MM-dd").format($P{P_FECHA_INI}) + "  Al: " + new java.text.SimpleDateFormat("yyyy-MM-dd").format($P{P_FECHA_FIN})]]></textFieldExpression></textField>
        </band>
    </title>

    <columnHeader>
        <band height="16">
            <staticText><reportElement x="120" y="0" width="200" height="16"/><text><![CDATA[Fecha]]></text></staticText>
            <staticText><reportElement x="320" y="0" width="100" height="16"/><text><![CDATA[Total día]]></text></staticText>
        </band>
    </columnHeader>

    <detail>
        <band height="16">
            <textField><reportElement x="120" y="0" width="200" height="16"/><textFieldExpression><![CDATA[new java.text.SimpleDateFormat("yyyy-MM-dd").format($F{fecha_dia})]]></textFieldExpression></textField>
            <textField><reportElement x="320" y="0" width="100" height="16"/><textFieldExpression><![CDATA[$F{total_dia}]]></textFieldExpression></textField>
        </band>
    </detail>

    <summary>
        <band height="20">
            <staticText><reportElement x="220" y="0" width="100" height="20"/><text><![CDATA[TOTAL RANGO:]]></text></staticText>
            <textField><reportElement x="320" y="0" width="100" height="20"/><textFieldExpression><![CDATA[$V{TOTAL}]]></textFieldExpression></textField>
        </band>
    </summary>
</jasperReport>
